<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit to GitHub</title>
</head>
<body>
    <h1>Submit Your Details</h1>
    <form id="dataForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required><br><br>
        
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <button type="submit">Submit</button>
    </form>

    <script>
        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent the form from submitting the default way

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;

            const data = {
                name: name,
                email: email
            };

            // GitHub repository information
            const repoOwner = 'eesagpkp';
            const repoName = 'technoenhance2025';
            const filePath = 'data.json';  // Path to the file in your repo

            // Create a JSON object with the form data
            const newData = JSON.stringify([data], null, 2);

            // GitHub Personal Access Token (DO NOT expose in production - this is just for demonstration)
            const githubToken = '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';  // Replace with your GitHub token

            // Commit the data to GitHub using the GitHub API
            commitToGitHub(repoOwner, repoName, filePath, newData, githubToken);
        });

        // Function to commit data to GitHub
        function commitToGitHub(owner, repo, path, newContent, token) {
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

            // Fetch the existing content of the file, if it exists
            fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json',
                }
            })
            .then(response => response.json())
            .then(data => {
                let existingData = [];

                if (data.content) {
                    // If the file exists, decode and parse the existing content
                    existingData = JSON.parse(atob(data.content)); // Decode base64 content
                }

                // Append the new data to the existing content
                existingData.push(JSON.parse(newContent)[0]);

                // Prepare the data to be committed
                const updatedContent = JSON.stringify(existingData, null, 2); // Reformat the updated content
                const commitData = {
                    message: 'Add new form data',
                    content: btoa(updatedContent), // Encode updated content to base64
                    sha: data.sha || '', // Use the file SHA if the file exists
                };

                // Push the content (commit) to GitHub
                return fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                    },
                    body: JSON.stringify(commitData),
                });
            })
            .then(response => response.json())
            .then(data => {
                console.log('File committed to GitHub:', data);
                alert('Data committed to GitHub!');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error committing to GitHub.');
            });
        }
    </script>
</body>
</html>
